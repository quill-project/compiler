<!doctype html>
<html>
<head>
    <script src="quill.js"></script>
    <script>

    const print = thing => console.log(thing);
    const add = (a, b) => a + b;
    const sqrt = x => Math.sqrt(x);
    const rand = () => Math.random();
    const PI = Math.PI;

    const sources = {
        "test.quill": `

mod js

pub ext fun print_int(n: Int) = print
pub ext fun print_float(x: Float) = print
pub ext fun print_bool(b: Bool) = print
pub ext fun rand() -> Float = rand
pub ext fun add_int(a: Int, b: Int) -> Int = add
pub ext fun add_float(a: Float, b: Float) -> Float = add
pub ext fun sqrt(x: Float) -> Float = sqrt
pub ext val PI: Float = PI


mod pet

struct Cat(age: Int, hunger: Float)

pub fun make_cat(age: Int, hunger: Float) -> Cat 
    = Cat(age, hunger)

pub fun feed(self: Cat) {
    self.hunger = 0.0
}

pub fun hunger_of(self: Cat) -> Float = self.hunger


mod dyn

pub enum Number(Int: Int, Float: Float)
pub enum Role(Guest, Member, Moderator, Admin)


pub struct Vec3(x: Float, y: Float, z: Float)


// match my_vec {
//     Vec3(5.0, 1.0, z) {
//         ...
//     }
//     Vec3(2.0, y, z) {
//         ...
//     }
//     Vec3(x, y, z) {
//     
//     }
// }


// if(my_vec.x == 5.0 && my_vec.y == 1.0) {
//    const z = my_vec.z;
// } else if(my_vec.x == 2.0) {
//     const y = my_vec.y;
//     const z = my_vec.z;
// } else {
//     const x = my_vec.x;
//     const y = my_vec.y;
//     const z = my_vec.z;
// }



mod test

fun fib(n: Int) -> Int =
    if n <= 1 { n }
    else { fib(n - 1) + fib(n - 2) }

fun main() {
    val my_num: dyn::Number = dyn::Number::Int(5)
    val my_role: dyn::Role = dyn::Role::Guest
    js::print_bool(my_num == dyn::Number::Int(5))
}

fun print_is_even(n: Int, c: Int) {
    if c == n { return unit }
    js::print_bool(is_even(c))
    print_is_even(n, c + 1)
}

fun abs(n: Int) -> Int = if n < 0 { -n } else { n }

enum OptionalInt(Some: Int, Maybe: Float, None)

fun double(n: OptionalInt) {
    match n {
        OptionalInt::Some(5) {}
        OptionalInt::Some(x) {}
        OptionalInt::Maybe(x) {}
    }
}

fun is_even(n: Int) -> Bool {
    match abs(n) {
        0 | 2 | 4 | 6 | 8 | 10 | 12 | 14 | 16 | 18 | 20 { return true }
        1 | 3 | 5 | 7 | 9 | 11 | 13 | 15 | 17 | 19 | 21 { return false }
        x {}
    }
    return js::rand() < 0.5
}

        `
    };

    const result = quill.compile(sources);
    if(result.success) {
        console.log(result.code);
        eval(result.code);
        test$main();
    } else {
        console.log(result.errors
            .map(e => quill.message.display(e, sources))
            .join("\n\n")
        );
    }
    </script>
</head>
<body></body>
</html>