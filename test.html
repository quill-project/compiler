<!doctype html>
<html>
<head>
    <script src="quill.js"></script>
    <script>

    const print = thing => console.log(thing);
    const add = (a, b) => a + b;
    const sqrt = x => Math.sqrt(x);
    const rand = () => Math.random();
    const PI = Math.PI;

    const sources = {
        "test.quill": `

mod js

pub ext fun print_int(n: Int) = print
pub ext fun print_float(x: Float) = print
pub ext fun print_bool(b: Bool) = print
pub ext fun rand() -> Float = rand
pub ext fun add_int(a: Int, b: Int) -> Int = add
pub ext fun add_float(a: Float, b: Float) -> Float = add
pub ext fun sqrt(x: Float) -> Float = sqrt
pub ext val PI: Float = PI


mod pet

struct Cat(age: Int, hunger: Float)

pub fun make_cat(age: Int, hunger: Float) -> Cat 
    = Cat(age, hunger)

fun feed(self: Cat) {
    self.hunger = 0.0
}


mod test

fun fib(n: Int) -> Int =
    if n <= 1 { n }
    else { fib(n - 1) + fib(n - 2) }

fun main() {
    js::print_float(3.5)
    js::print_int(fib(10))
    print_is_even(20, 0)
    val my_cat = pet::make_cat(5, 1.0)
    js::print_float(my_cat.hunger)
}

fun print_is_even(n: Int, c: Int) {
    if c == n { return unit }
    js::print_bool(is_even(c))
    print_is_even(n, c + 1)
}

fun abs(n: Int) -> Int = if n < 0 { -n } else { n }

fun is_even(n: Int) -> Bool {
    case abs(n) {
        0 { return true }
        1 { return false }
        2 { return true }
        3 { return false }
        4 { return true }
        5 { return false }
        6 { return true }
        7 { return false }
        8 { return true }
    }
    return js::rand() < 0.5
}

fun double(a: Float) -> Float = a * 2.0

val TAU: Float = double(js::PI)

        `
    };

    const result = quill.compile(sources);
    if(result.success) {
        console.log(result.code);
        eval(result.code);
        test$main();
    } else {
        console.log(result.errors
            .map(e => quill.message.display(e, sources))
            .join("\n\n")
        );
    }
    </script>
</head>
<body></body>
</html>